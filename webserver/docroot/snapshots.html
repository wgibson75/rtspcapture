<html>
  <head>
    <style>
      body {
        height: 100vh;
        width: 100vw;
      }

      td {
        text-align: center;
        font-weight: bold;
        color: #ffff00;
      }

      #control {
        position: absolute;
        width: 100%;
        height: 50px;
      }

      #snapshot {
        width: 100%;
        height: 100%;
      }

      #time {
        font-weight: normal;
        color: #cccc00;
      }

      .holder {
        width: 100%;
        height: 100%;
        position: relative;
      }
    </style>
  </head>
  <script src="jquery-3.7.1.min.js"></script>
  <script>

  const JSON_SUMMARY_FILE = 'snapshots/snapshots.json';
  const CONTROL_OFFSET_P = '250px';
  const CONTROL_OFFSET_H = '30px';
  const CONTROL_TEXT_SIZE_P = '30pt';
  const CONTROL_TEXT_SIZE_H = '25pt';

  let Snapshots = [];
  let Snapshots_index = 0;
  let Orientation = window.orientation;

  function positionControls() {
    if (Orientation == 0) { // If portrait
      $('#control').css('bottom', CONTROL_OFFSET_P);
      $('.control').css('fontSize', CONTROL_TEXT_SIZE_P);
    }
    else {
      $('#control').css('bottom', CONTROL_OFFSET_H);
      $('.control').css('fontSize', CONTROL_TEXT_SIZE_H);
    }
  }

  $(document).ready(function () {
    positionControls();

    $.getJSON(JSON_SUMMARY_FILE, function(data) {
      Snapshots = data.snapshots;
      insertSnapshotPane();
      showSnapshot();
    });
  });

  $(window).bind("orientationchange", function(){
    Orientation = window.orientation;
    positionControls();
  });

  function getSnapshotUrl(index) {
    return 'snapshots/' + Snapshots[index];
  }

  function getSnapshotTime(index) {
    let filename = Snapshots[index];
    let filenameNoExt = filename.split(".")[0];
    let epoch = filenameNoExt.split("_")[1];
    return epoch;
  }

  function showSnapshot() {
    let banner = document.getElementById('banner');
    let time = getSnapshotTime(Snapshots_index);
    let date = new Date(0);
    date.setUTCMilliseconds(time);
    let d = date.toString().split(' ');
    d.splice(5, d.length - 5);
    document.getElementById('time').innerHTML = d.join(' ');

    let snapshot = document.getElementById('snapshot');
    snapshot.src = getSnapshotUrl(Snapshots_index);
  }

  function insertSnapshotPane() {
    let paneId = document.createAttribute('id');
    paneId.value = 'snapshot';

    let pane = document.createElement('iframe');
    pane.setAttributeNode(paneId);

    document.getElementById('main').appendChild(pane);;
  }

  function nextSnapshot() {
    if ((Snapshots.length != 0) && ((Snapshots_index + 1) < Snapshots.length)) {
      showSnapshot(++Snapshots_index);
    }
  }

  function prevSnapshot() {
    if ((Snapshots.length != 0) && (Snapshots_index > 0)) {
      showSnapshot(--Snapshots_index);
    }
  }

  function keypressHandler(e) {
    if (e.code == 'Space') nextSnapshot();
  }

  function keydownHandler(e) {
    if (e.code == 'ArrowLeft') {
      prevSnapshot();
    }
    else if (e.code == 'ArrowRight') {
      nextSnapshot();
    }
  }

  function init() {
    document.addEventListener('keypress', keypressHandler);
    document.addEventListener('keydown', keydownHandler);
  }

  </script>
   <body onload="init()" bgcolor="black">
     <div class="holder">
       <div id="main">
       </div>
       <div id="control">
         <table width="100%" heigh="100%" cellspacing="10" cellpadding="10" class="control">
           <tr>
             <td width="55%" id="time">Loading please wait...</td>
             <td width="15%" onclick="document.location.replace('/')">HOME</td> 
             <td width="15%" onclick="prevSnapshot()">&lt;&lt;</td>
             <td width="15%" onclick="nextSnapshot()">&gt;&gt;</td>
           </tr>
         </table>
       </div>
     </div>
  </body>
</html>
